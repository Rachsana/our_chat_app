{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef } from 'react';\nconst useSSE = onMessage => {\n  _s();\n  const eventSourceRef = useRef(null);\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (!token) return;\n    const apiUrl = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\n    const url = `${apiUrl}/chat/stream?token=${token}`;\n    const eventSource = new EventSource(url);\n    eventSource.onmessage = event => {\n      try {\n        const data = JSON.parse(event.data);\n        if (onMessage) {\n          onMessage(data);\n        }\n      } catch (error) {\n        console.error('Error parsing SSE message:', error);\n      }\n    };\n    eventSource.onerror = error => {\n      console.error('SSE error:', error);\n      eventSource.close();\n      setTimeout(() => {\n        if (localStorage.getItem('token')) {\n          window.location.reload();\n        }\n      }, 5000);\n    };\n    eventSourceRef.current = eventSource;\n    return () => {\n      if (eventSourceRef.current) {\n        eventSourceRef.current.close();\n      }\n    };\n  }, [onMessage]);\n  return eventSourceRef;\n};\n_s(useSSE, \"b1c+3X0XI4c0IDvKH+sILfqJdOI=\");\nexport default useSSE;","map":{"version":3,"names":["useEffect","useRef","useSSE","onMessage","_s","eventSourceRef","token","localStorage","getItem","apiUrl","process","env","REACT_APP_API_URL","url","eventSource","EventSource","onmessage","event","data","JSON","parse","error","console","onerror","close","setTimeout","window","location","reload","current"],"sources":["C:/Users/rrach/OneDrive/Desktop/our_chat_app/client/src/utils/useSSE.js"],"sourcesContent":["import { useEffect, useRef } from 'react';\r\n\r\nconst useSSE = (onMessage) => {\r\n  const eventSourceRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) return;\r\n\r\n    const apiUrl = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\r\n    const url = `${apiUrl}/chat/stream?token=${token}`;\r\n    const eventSource = new EventSource(url);\r\n\r\n    eventSource.onmessage = (event) => {\r\n      try {\r\n        const data = JSON.parse(event.data);\r\n        if (onMessage) {\r\n          onMessage(data);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error parsing SSE message:', error);\r\n      }\r\n    };\r\n\r\n    eventSource.onerror = (error) => {\r\n      console.error('SSE error:', error);\r\n      eventSource.close();\r\n      \r\n      setTimeout(() => {\r\n        if (localStorage.getItem('token')) {\r\n          window.location.reload();\r\n        }\r\n      }, 5000);\r\n    };\r\n\r\n    eventSourceRef.current = eventSource;\r\n\r\n    return () => {\r\n      if (eventSourceRef.current) {\r\n        eventSourceRef.current.close();\r\n      }\r\n    };\r\n  }, [onMessage]);\r\n\r\n  return eventSourceRef;\r\n};\r\n\r\nexport default useSSE;"],"mappings":";AAAA,SAASA,SAAS,EAAEC,MAAM,QAAQ,OAAO;AAEzC,MAAMC,MAAM,GAAIC,SAAS,IAAK;EAAAC,EAAA;EAC5B,MAAMC,cAAc,GAAGJ,MAAM,CAAC,IAAI,CAAC;EAEnCD,SAAS,CAAC,MAAM;IACd,MAAMM,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;IAC3C,IAAI,CAACF,KAAK,EAAE;IAEZ,MAAMG,MAAM,GAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,IAAI,2BAA2B;IAC3E,MAAMC,GAAG,GAAG,GAAGJ,MAAM,sBAAsBH,KAAK,EAAE;IAClD,MAAMQ,WAAW,GAAG,IAAIC,WAAW,CAACF,GAAG,CAAC;IAExCC,WAAW,CAACE,SAAS,GAAIC,KAAK,IAAK;MACjC,IAAI;QACF,MAAMC,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACH,KAAK,CAACC,IAAI,CAAC;QACnC,IAAIf,SAAS,EAAE;UACbA,SAAS,CAACe,IAAI,CAAC;QACjB;MACF,CAAC,CAAC,OAAOG,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;MACpD;IACF,CAAC;IAEDP,WAAW,CAACS,OAAO,GAAIF,KAAK,IAAK;MAC/BC,OAAO,CAACD,KAAK,CAAC,YAAY,EAAEA,KAAK,CAAC;MAClCP,WAAW,CAACU,KAAK,CAAC,CAAC;MAEnBC,UAAU,CAAC,MAAM;QACf,IAAIlB,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,EAAE;UACjCkB,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAC;QAC1B;MACF,CAAC,EAAE,IAAI,CAAC;IACV,CAAC;IAEDvB,cAAc,CAACwB,OAAO,GAAGf,WAAW;IAEpC,OAAO,MAAM;MACX,IAAIT,cAAc,CAACwB,OAAO,EAAE;QAC1BxB,cAAc,CAACwB,OAAO,CAACL,KAAK,CAAC,CAAC;MAChC;IACF,CAAC;EACH,CAAC,EAAE,CAACrB,SAAS,CAAC,CAAC;EAEf,OAAOE,cAAc;AACvB,CAAC;AAACD,EAAA,CA3CIF,MAAM;AA6CZ,eAAeA,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}