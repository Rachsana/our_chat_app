{"ast":null,"code":"import{useEffect,useRef}from'react';const useSSE=onMessage=>{const eventSourceRef=useRef(null);useEffect(()=>{const token=localStorage.getItem('token');if(!token)return;const apiUrl=process.env.REACT_APP_API_URL||'http://localhost:5000/api';const url=\"\".concat(apiUrl,\"/chat/stream?token=\").concat(token);const eventSource=new EventSource(url);eventSource.onmessage=event=>{try{const data=JSON.parse(event.data);if(onMessage){onMessage(data);}}catch(error){console.error('Error parsing SSE message:',error);}};eventSource.onerror=error=>{console.error('SSE error:',error);eventSource.close();setTimeout(()=>{if(localStorage.getItem('token')){window.location.reload();}},5000);};eventSourceRef.current=eventSource;return()=>{if(eventSourceRef.current){eventSourceRef.current.close();}};},[onMessage]);return eventSourceRef;};export default useSSE;","map":{"version":3,"names":["useEffect","useRef","useSSE","onMessage","eventSourceRef","token","localStorage","getItem","apiUrl","process","env","REACT_APP_API_URL","url","concat","eventSource","EventSource","onmessage","event","data","JSON","parse","error","console","onerror","close","setTimeout","window","location","reload","current"],"sources":["C:/Users/rrach/OneDrive/Desktop/our_chat_app/client/src/utils/useSSE.js"],"sourcesContent":["import { useEffect, useRef } from 'react';\r\n\r\nconst useSSE = (onMessage) => {\r\n  const eventSourceRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) return;\r\n\r\n    const apiUrl = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\r\n    const url = `${apiUrl}/chat/stream?token=${token}`;\r\n    const eventSource = new EventSource(url);\r\n\r\n    eventSource.onmessage = (event) => {\r\n      try {\r\n        const data = JSON.parse(event.data);\r\n        if (onMessage) {\r\n          onMessage(data);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error parsing SSE message:', error);\r\n      }\r\n    };\r\n\r\n    eventSource.onerror = (error) => {\r\n      console.error('SSE error:', error);\r\n      eventSource.close();\r\n      \r\n      setTimeout(() => {\r\n        if (localStorage.getItem('token')) {\r\n          window.location.reload();\r\n        }\r\n      }, 5000);\r\n    };\r\n\r\n    eventSourceRef.current = eventSource;\r\n\r\n    return () => {\r\n      if (eventSourceRef.current) {\r\n        eventSourceRef.current.close();\r\n      }\r\n    };\r\n  }, [onMessage]);\r\n\r\n  return eventSourceRef;\r\n};\r\n\r\nexport default useSSE;"],"mappings":"AAAA,OAASA,SAAS,CAAEC,MAAM,KAAQ,OAAO,CAEzC,KAAM,CAAAC,MAAM,CAAIC,SAAS,EAAK,CAC5B,KAAM,CAAAC,cAAc,CAAGH,MAAM,CAAC,IAAI,CAAC,CAEnCD,SAAS,CAAC,IAAM,CACd,KAAM,CAAAK,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAI,CAACF,KAAK,CAAE,OAEZ,KAAM,CAAAG,MAAM,CAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,EAAI,2BAA2B,CAC3E,KAAM,CAAAC,GAAG,IAAAC,MAAA,CAAML,MAAM,wBAAAK,MAAA,CAAsBR,KAAK,CAAE,CAClD,KAAM,CAAAS,WAAW,CAAG,GAAI,CAAAC,WAAW,CAACH,GAAG,CAAC,CAExCE,WAAW,CAACE,SAAS,CAAIC,KAAK,EAAK,CACjC,GAAI,CACF,KAAM,CAAAC,IAAI,CAAGC,IAAI,CAACC,KAAK,CAACH,KAAK,CAACC,IAAI,CAAC,CACnC,GAAIf,SAAS,CAAE,CACbA,SAAS,CAACe,IAAI,CAAC,CACjB,CACF,CAAE,MAAOG,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,4BAA4B,CAAEA,KAAK,CAAC,CACpD,CACF,CAAC,CAEDP,WAAW,CAACS,OAAO,CAAIF,KAAK,EAAK,CAC/BC,OAAO,CAACD,KAAK,CAAC,YAAY,CAAEA,KAAK,CAAC,CAClCP,WAAW,CAACU,KAAK,CAAC,CAAC,CAEnBC,UAAU,CAAC,IAAM,CACf,GAAInB,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAAE,CACjCmB,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAC,CAC1B,CACF,CAAC,CAAE,IAAI,CAAC,CACV,CAAC,CAEDxB,cAAc,CAACyB,OAAO,CAAGf,WAAW,CAEpC,MAAO,IAAM,CACX,GAAIV,cAAc,CAACyB,OAAO,CAAE,CAC1BzB,cAAc,CAACyB,OAAO,CAACL,KAAK,CAAC,CAAC,CAChC,CACF,CAAC,CACH,CAAC,CAAE,CAACrB,SAAS,CAAC,CAAC,CAEf,MAAO,CAAAC,cAAc,CACvB,CAAC,CAED,cAAe,CAAAF,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}